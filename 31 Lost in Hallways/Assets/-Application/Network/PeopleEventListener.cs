using System;
using UnityEngine;

public class PeopleEventListener : AppsEventListener
{
	[System.Serializable]
	public class tagData
	{
		public bool		HttpLog         = false;
		public bool		PacketEventLog  = false;
		public bool		Log             = false;
		public float	Version         = 0.0001f;
		public bool		AutoUpdate		= false;
		public bool		AutoLogin		= false;
	};
	public tagData data = new tagData();

	//인터페이스를 시작하기 위한 함수
	void Start()
	{
		Apps.onConnectFailed	+= onConnectFailed;
		Apps.onReceive			+= onReceive;
		Apps.onConnect			+= onConnect;
		Apps.onUpdateEnd		+= onUpdateEnd;
//		Apps.onRegister			+= onRegister;
		Apps.onLogin			+= onLogin;
		Apps.onLoginEnd			+= onLoginEnd;
		Apps.onFriend			+= onFriend;
		Apps.onMemorize			+= onMemorize;
		Apps.onStorage			+= onStorage;
		Apps.onBuy				+= onBuy;
		Apps.onFailed			+= onFailed;
		Apps.onEcho				+= onEcho;
		Apps.onItemState		+= onItemState;
		Apps.onClientMessage	+= onClientMessage;
		Apps.onPlatformInfo		+= onPlatformInfo;
		Apps.onLevel			+= onLevel;
		Apps.onExp				+= onExp;
		Apps.onCash				+= onCash;
		Apps.onPoint			+= onPoint;
		Apps.onTime				+= onTime;
//		Apps.onShutdown			+= onShutdown;
//		Apps.onPatch			+= onPatch;

		Apps.SetAutoUpdate( data.AutoUpdate );
		Apps.SetAutoLogin( data.AutoLogin );

		Apps.Connect( this );
		AppsHttpProtocol.SetLog( data.HttpLog );
		Apps.SetPacketEventLog( data.PacketEventLog );
		Apps.SetLog( data.Log );
	}

	//-------------------------------------------------------------------------------------------------------------------------------
	// 패킷 수신에 반응하기 위한 함수
	//-------------------------------------------------------------------------------------------------------------------------------
	void onReceive( string compile, AppsParameter col )
	{
		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		if( (compile)==(null) ) return;
		if( (col)==(null) ) return;

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		app.Receive.ON( (compile), (col) );

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
	}

	//-------------------------------------------------------------------------------------------------------------------------------
	// 버전이 일치하지 않습니다.
	//-------------------------------------------------------------------------------------------------------------------------------
	void onVersion( AppsParameter col )
	{
		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		if( (col)==(null) ) return;

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		Debug.Log( "어플리케이션 버전이 최신 버전이 아닙니다. 버전을 업데이트해주세요." );

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
	}

	//-------------------------------------------------------------------------------------------------------------------------------
	// 서버 연결에 반응하기 위한 함수
	//-------------------------------------------------------------------------------------------------------------------------------
	void onConnect( AppsParameter col )
	{
		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		if( (col)==(null) ) return;

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		/*
		if( !FacebookAndroid.isSessionValid() )
		{
			Apps.LocalizeLogin();
		}
		*/

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
	}

	//-------------------------------------------------------------------------------------------------------------------------------
	// 로그인에 반응하기 위한 함수
	//-------------------------------------------------------------------------------------------------------------------------------
	void onRegister( AppsParameter col )
	{
		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		if( (col)==(null) ) return;

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		PlayerPrefs.SetInt( "ViewBusiness-Fold", (1) );

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
	}

	//-------------------------------------------------------------------------------------------------------------------------------
	// 로그인에 반응하기 위한 함수
	//-------------------------------------------------------------------------------------------------------------------------------
	void onLogin( AppsParameter col )
	{
		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		if( (col)==(null) ) return;

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		if( app.ViewLoading.Is(app.Account) )
		{
			app.Engine.Scene( SCENE.APPLICATION_CONTRACT );
			app.ViewLoading.OFF(app.Account);
		}

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
	}

	//-------------------------------------------------------------------------------------------------------------------------------
	// 친구 정보를 처리하기 위한 함수
	//-------------------------------------------------------------------------------------------------------------------------------
	void onFriend( AppsParameter col )
	{
		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		if( (col)==(null) ) return;

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
//      Debug.Log( "id = "+col.Get("id")+", name = "+col.Get("name")+", score= "+col.Get("score") );

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
	}

	//로그인 종료를 처리하기 위한 함수
	void onLoginEnd( AppsParameter col )
	{
		if( col==null ) return;

		if( play.Scene==SCENE.APPLICATION_CONTRACT )
		{
			//다운로드 종료 후, 첫 화면을 실행 시킴
//			app.Download.SetCallback( app.Engine.funcLoginEnd );
		}
		else
		{
			app.Engine.ApplicationContractAgree();
		}
	}

	//-------------------------------------------------------------------------------------------------------------------------------
	// 메모리 정보를 얻기 위한 함수
	//-------------------------------------------------------------------------------------------------------------------------------
	void onMemorize( AppsParameter col )
	{
		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		if( (col)==(null) ) return;

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		app.Memorize.ON( col.Get("column"), col.Get("value") );

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
	}

	//-------------------------------------------------------------------------------------------------------------------------------
	// 입고 정보를 얻기 위한 함수
	//-------------------------------------------------------------------------------------------------------------------------------
	void onStorage( AppsParameter col )
	{
		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		if( (col)==(null) ) return;

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
//		app.Storage.ON( col );

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
	}

	//-------------------------------------------------------------------------------------------------------------------------------
	// 구매 정보를 얻기 위한 함수
	//-------------------------------------------------------------------------------------------------------------------------------
	void onBuy( AppsParameter col )
	{
		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		if( (col)==(null) ) return;

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		tagAppsItem		appsitem	= Apps.FindAppsItem( col.Get("item") );
		if( (appsitem)!=(null) )
		{
			if( appsitem.nonstorage )
			{
//				app.Confirm.ON( Func.Script( (TEXT.__를_구매했습니다), app.Language.Get(appsitem.Name()) ) );
			}
			else
			{
//				app.Confirm.ON( Func.Script( (TEXT.__를_구매했습니다_구매하신_항목은_장바구니에서_사용하실_수_있습니다), app.Language.Get(appsitem.Name()) ) );
			}
		}
		else
		{
			Debug.Log(col.Get("item"));
		}

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		app.ViewIndigator.OFF( app.Purchase );

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
	}

	//-------------------------------------------------------------------------------------------------------------------------------
	// 실패 정보를 얻기 위한 함수
	//-------------------------------------------------------------------------------------------------------------------------------
	void onFailed( AppsParameter col )
	{
		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		if( (col)==(null) ) return;

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		Debug.Log("(Failed : "+col.Get("text")+") => "+col.GetUrl());

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
	}

	//출력 메세지를 얻기 위한 함수
	void onEcho( AppsParameter col )
	{
		if( col==null ) return;
		Debug.Log("(Echo : "+col.Get("text")+")");
	}

	//업데이트 정보 전송이 종료됨
	void onUpdateEnd( AppsParameter col )
	{
		if( col==null ) return;

		if( !app.Download.Is() )
		{
			app.Download.Complete();
		}

		//Complete 처리하면서 새로운 다운로드가 발생했을 수 있기 때문에
		//다운로드 여부를 다시 확인함
		if( !app.Download.Is() )
		{
			app.ViewLoading.OFF( this );
		}
	}

	//아이템 정보를 얻기 위한 함수
	void onItemState( AppsParameter col )
	{
		if( col==null ) return;

		string strClass = col.Get("class");
		if( !Library.Is(strClass) ) return;

		string strType = col.Get("type");

		if( ( Platform.IsEditor() && col.request!=null && data.Log ) || Platform.IsRuntime() )
		{
			Debug.LogWarning( col );
		}

		Debug.Log( "Not found Update class: "+(col) );
	}

	//서버 연결에 실패했을 때 반응하기 위한 함수
	void onConnectFailed()
	{
		app.ViewLoading.OFF();
		app.Game.funcStart();

		/*
		if( Platform.IsEditor() )
		{
			app.ViewLoading.OFF();
			app.Game.funcStart();
		}
		else
		{
//			app.Confirm.ON( app.Language.Get(TEXT.서버에_접속하지_못했습니다), (app.Engine.funcQuit) );
		}
		*/
	}

	//-------------------------------------------------------------------------------------------------------------------------------
	// 클라이언트 메세지 정보를 처리하기 위한 함수
	//-------------------------------------------------------------------------------------------------------------------------------
	void onClientMessage( AppsParameter col )
	{
		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		if( (col)==(null) ) return;

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		app.Engine.ClientMessage( col.Get("message") );

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
	}

	//-------------------------------------------------------------------------------------------------------------------------------
	// 플랫폼 정보를 얻기 위한 함수
	//-------------------------------------------------------------------------------------------------------------------------------
	void onPlatformInfo( AppsParameter col )
	{
		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		if( (col)==(null) ) return;

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		Debug.LogWarning( col );

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
	}

	//-------------------------------------------------------------------------------------------------------------------------------
	// 레벨 정보를 수신하기 위한 함수
	//-------------------------------------------------------------------------------------------------------------------------------
	void onLevel( AppsParameter col )
	{
		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		if( (col)==(null) ) return;

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
//		app.Player.SetLevel( col.GetInt("level") );

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
	}

	//-------------------------------------------------------------------------------------------------------------------------------
	// 경험치 정보를 수신하기 위한 함수
	//-------------------------------------------------------------------------------------------------------------------------------
	void onExp( AppsParameter col )
	{
		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		if( (col)==(null) ) return;

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
//		app.Player.SetExpRange( col.GetInt("exp_min"), col.GetInt("exp_max") );
//		app.Player.SetExp( col.GetInt("exp") );

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
	}

	//-------------------------------------------------------------------------------------------------------------------------------
	// 캐쉬 정보를 수신하기 위한 함수
	//-------------------------------------------------------------------------------------------------------------------------------
	void onCash( AppsParameter col )
	{
		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		if( (col)==(null) ) return;

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		int Cash = col.GetInt("cash");

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		app.Account.Cash( Cash );
//		app.ViewFinance.Cash( Cash );

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
	}

	//-------------------------------------------------------------------------------------------------------------------------------
	// 포인트 정보를 수신하기 위한 함수
	//-------------------------------------------------------------------------------------------------------------------------------
	void onPoint( AppsParameter col )
	{
		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		if( (col)==(null) ) return;

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
//		Debug.LogWarning( col.GetEcho() );

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
	}

	//-------------------------------------------------------------------------------------------------------------------------------
	// 시간 정보를 수신하기 위한 함수
	//-------------------------------------------------------------------------------------------------------------------------------
	void onTime( AppsParameter col )
	{
		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		if( (col)==(null) ) return;

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		(play.serverTime)	= col.GetLong("time");
		(play.fServerTime)	= (0);

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		DateTime	time	= new DateTime( (1970), (1), (1), (0), (0), (0), (0), (DateTimeKind.Utc) );
		(play.utcTime)		= time.AddSeconds(col.GetLong("time"));
		(play.preDateTime)	= (DateTime.Now);

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
	}

	//-------------------------------------------------------------------------------------------------------------------------------
	// -
	//-------------------------------------------------------------------------------------------------------------------------------
	void onShutdown( AppsParameter col )
	{
		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		if( (col)==(null) ) return;

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		app.Confirm.ON( app.Language.Get(TEXT.점검중입니다), (app.Engine.funcQuit) );

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
	}

	//-------------------------------------------------------------------------------------------------------------------------------
	// -
	//-------------------------------------------------------------------------------------------------------------------------------
	void onPatch( AppsParameter col )
	{
		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		if( (col)==(null) ) return;

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		app.Confirm.ON( app.Language.Get(TEXT.최신_버전을_설치해주세요), (app.Engine.funcQuit) );

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
	}

	//-------------------------------------------------------------------------------------------------------------------------------
	// -
	//-------------------------------------------------------------------------------------------------------------------------------
}

//-----------------------------------------------------------------------------------------------------------------------------------
// -
//-----------------------------------------------------------------------------------------------------------------------------------