using UnityEngine;
using System.Collections;
using System.Collections.Generic;

//-----------------------------------------------------------------------------------------------------------------------------------
// 플레이어 정보를 처리하기 위한 클래스
//-----------------------------------------------------------------------------------------------------------------------------------
public class CPlayer : FrameworkBehaviour
{
	//-------------------------------------------------------------------------------------------------------------------------------
	// -
	//-------------------------------------------------------------------------------------------------------------------------------
	[System.Serializable]
	public class tagData
	{
		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		public tagPerson			person		= (null);
		public tagCurrencyStatic	currency	= (null);

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
	};
	public tagData data = new tagData();

	//-------------------------------------------------------------------------------------------------------------------------------
	// ID를 얻기 위한 함수
	//-------------------------------------------------------------------------------------------------------------------------------
	public string ID()
	{
		/*
		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		if( Character()!=(null) )
		{
			return Character().ID();
		}
		*/

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		return (null);
	}

	//-------------------------------------------------------------------------------------------------------------------------------
	// 인물을 설정하기 위한 함수
	//-------------------------------------------------------------------------------------------------------------------------------
	public void Set( tagPerson person )
	{
		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		if( (person)==(null) ) return;

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		(data.person) = (person);

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
	}

	//-------------------------------------------------------------------------------------------------------------------------------
	// 인물 정보를 얻기 위한 함수
	//-------------------------------------------------------------------------------------------------------------------------------
	public tagPerson Person()
	{
		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		return (data.person);

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
	}

	//-------------------------------------------------------------------------------------------------------------------------------
	// 기업을 얻기 위한 함수
	//-------------------------------------------------------------------------------------------------------------------------------
	public tagCompany Company()
	{
		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		if( app.Identity.Company()!=(null) && Library.Is(app.Identity.Company().id) )
		{
			return app.Identity.Company();
		}

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		if( Person()!=(null) && Library.Is(Person().id) )
		{
			return Person().Company();
		}

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		return (null);
	}

	//-------------------------------------------------------------------------------------------------------------------------------
	// 국가를 얻기 위한 함수
	//-------------------------------------------------------------------------------------------------------------------------------
	public tagNationStatic Nation()
	{
		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		if( Person()!=(null) && Library.Is(Person().id) )
		{
			return (Person().nation);
		}

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		return (null);
	}

	//-------------------------------------------------------------------------------------------------------------------------------
	// 소재 도시를 얻기 위한 함수
	//-------------------------------------------------------------------------------------------------------------------------------
	public tagCityStatic City()
	{
		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		return app.City.Get();

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
	}

	//-------------------------------------------------------------------------------------------------------------------------------
	// -
	//-------------------------------------------------------------------------------------------------------------------------------
	public int GetBusinessCount()
	{
		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		int count = (0);

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		foreach( tagBusiness business in app.Business.GetList() )
		{
			if( app.Business.IsRight(business) )
			{
				(count)	+= (1);
			}
		}

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		return (count);
	}

	//-------------------------------------------------------------------------------------------------------------------------------
	// 자기 자신인지 확인하기 위한 함수
	//-------------------------------------------------------------------------------------------------------------------------------
	public bool Is( tagPerson person )
	{
		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		if( !app.Person.Is(person) ) return false;

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		if( (data.person)==(person) )
		{
			return true;
		}

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		return false;
	}

	//-------------------------------------------------------------------------------------------------------------------------------
	// 통화를 설정하기 위한 함수
	//-------------------------------------------------------------------------------------------------------------------------------
	public void Set( tagCurrencyStatic currency )
	{
		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		if( (currency)==(null) ) return;

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		(data.currency)	= (currency);

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
	}

	//-------------------------------------------------------------------------------------------------------------------------------
	// 통화를 설정하기 위한 함수
	//-------------------------------------------------------------------------------------------------------------------------------
	public tagCurrencyStatic Currency()
	{
		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		return (data.currency);

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
	}

	//-------------------------------------------------------------------------------------------------------------------------------
	// 이름을 얻기 위한 함수
	//-------------------------------------------------------------------------------------------------------------------------------
	public string Name()
	{
		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		if( app.Person.Is(Person()) )
		{
			return Person().name;
		}

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		return (null);
	}

	//-------------------------------------------------------------------------------------------------------------------------------
	// 텍스트 입력에 반응하기 위한 함수
	//-------------------------------------------------------------------------------------------------------------------------------
	public bool IsNameChange( string text )
	{
        //---------------------------------------------------------------------------------------------------------------------------
        // -
        //---------------------------------------------------------------------------------------------------------------------------
		if( !Library.Is(text) ) return false;

        //---------------------------------------------------------------------------------------------------------------------------
        // -
        //---------------------------------------------------------------------------------------------------------------------------
		string	letter	= (null);
		string	result	= (null);
		int		length	= (0);
		int		space	= (0);
		
        //---------------------------------------------------------------------------------------------------------------------------
        // -
        //---------------------------------------------------------------------------------------------------------------------------
		for( int i=0; i<(text.Length); i++ )
		{
			//-----------------------------------------------------------------------------------------------------------------------
		    // -
	        //-----------------------------------------------------------------------------------------------------------------------
			(letter)	= text[i].ToString();

			//-----------------------------------------------------------------------------------------------------------------------
		    // -
	        //-----------------------------------------------------------------------------------------------------------------------
			if( (i)==(0) && ( Library.IsNumber(letter) || (letter)==" " ) )
			{
				app.Confirm.ON( app.Language.Get(TEXT.첫글자는_영문이어야_합니다) );
				return false;
			}
			else
			if( Func.IsSpecialChar(letter) )
			{
				app.Confirm.ON( app.Language.Get(TEXT.특수문자는_사용할_수_없습니다) );
				return false;
			}
			else
			if( Func.IsAlphabetAndNumber(letter) )
			{
				(length)	+= (1);
			}
			else
			{
				(length)	+= (2);
			}

			//-----------------------------------------------------------------------------------------------------------------------
		    // -
	        //-----------------------------------------------------------------------------------------------------------------------
			if( (length)>(16) )
			{
				app.Confirm.ON( app.Language.Get(TEXT.영문_16글자까지만_가능합니다) );
				return false;
			}

			//-----------------------------------------------------------------------------------------------------------------------
		    // -
	        //-----------------------------------------------------------------------------------------------------------------------
			if( (letter)==" " )
			{
				(space)	+= (1);
			}

			//-----------------------------------------------------------------------------------------------------------------------
		    // -
	        //-----------------------------------------------------------------------------------------------------------------------
			(result)	+= (letter);

			//-----------------------------------------------------------------------------------------------------------------------
		    // -
	        //-----------------------------------------------------------------------------------------------------------------------
		}

        //---------------------------------------------------------------------------------------------------------------------------
        // 처음이나 끝에 공백을 사용할 수 없습니다.
        //---------------------------------------------------------------------------------------------------------------------------
		if( (text[0])==' ' || (text[text.Length-1])==' ' )
		{
			app.Confirm.ON( app.Language.Get(TEXT.처음이나_끝에_공백을_사용할_수_없습니다) );
			return false;
		}

        //---------------------------------------------------------------------------------------------------------------------------
        // 공백을 3개 이상 사용할 수 없습니다.
        //---------------------------------------------------------------------------------------------------------------------------
		if( (space)>(2) )
		{
			app.Confirm.ON( app.Language.Get(TEXT.공백을_3개_이상_사용할_수_없습니다) );
			return false;
		}

        //---------------------------------------------------------------------------------------------------------------------------
        // -
        //---------------------------------------------------------------------------------------------------------------------------
		return true;
	}

	//-------------------------------------------------------------------------------------------------------------------------------
	// -
	//-------------------------------------------------------------------------------------------------------------------------------
	public void funcEditName( object wParam=(null), object lParam=(null) )
	{
		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		if( (lParam)==(null) || lParam.GetType()!=typeof(string) ) return;

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		string text = (lParam as string).Trim();

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		if( Library.Is(Name()) && Name()==(text) )
		{
			//이름이 변경되지 않음
			app.ViewInput.OFF();
			return;
		}
		else
		if( !Library.Is(Name()) && !Library.Is(text) )
		{
			//이름이 입력되지 않음
			app.Confirm.ON( app.Language.Get(TEXT.무작위_이름을_사용하시겠습니까), (CONFIRM.YESNO), (funcRandomNameChange), (null), (text) );
			return;
		}

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		if( IsNameChange(text) )
		{
			NameChange(text);
		}

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
	}

	//-------------------------------------------------------------------------------------------------------------------------------
	// -
	//-------------------------------------------------------------------------------------------------------------------------------
	public void funcRandomNameChange( object wParam=(null), object lParam=(null) )
	{
		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		if( (lParam)==(null) || lParam.GetType()!=typeof(string) ) return;

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		string text = (lParam as string).Trim();

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		if( !Library.Is(Name()) && !Library.Is(text) )
		{
			NameChange(text);
		}

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
	}

	//-------------------------------------------------------------------------------------------------------------------------------
	// 이름을 변경하기 위한 함수
	//-------------------------------------------------------------------------------------------------------------------------------
	void NameChange( string text )
	{
		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
//		if( !Library.Is(text) ) return;	//(NULL)값을 허용함

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		app.ViewIndigator.ON( (this), app.Language.Get(TEXT.잠시만_기다려주세요) );
		PeopleHash.NameChange( text );

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
	}

	//-------------------------------------------------------------------------------------------------------------------------------
	// -
	//-------------------------------------------------------------------------------------------------------------------------------
}

//-----------------------------------------------------------------------------------------------------------------------------------
// -
//-----------------------------------------------------------------------------------------------------------------------------------