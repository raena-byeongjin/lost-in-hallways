using System.Collections;
using System.Collections.Generic;
using System.Xml;
using UnityEngine;

//구매 정보를 처리하기 위한 클래스
public class CPurchase : AppsItemListener
{
	private List<tagPurchase> Purchases = new List<tagPurchase>();

	protected override void Awake()
	{
		base.Awake();
		Initialize( "Purchase", UPDATE_CLASS.Purchase.ToString() );
	}

	//-------------------------------------------------------------------------------------------------------------------------------
    // 객체를 생성하기 위한 함수 
	//-------------------------------------------------------------------------------------------------------------------------------
    protected override tagAppsItem New()
    {
        //---------------------------------------------------------------------------------------------------------------------------
        // -
	    //---------------------------------------------------------------------------------------------------------------------------
        return new tagPurchase();

        //---------------------------------------------------------------------------------------------------------------------------
        // -
	    //---------------------------------------------------------------------------------------------------------------------------
    }

	//-------------------------------------------------------------------------------------------------------------------------------
	// 객체를 삭제하기 위한 함수 
	//-------------------------------------------------------------------------------------------------------------------------------
	protected override void OnDelete( tagAppsItem appsItem )
	{
        //---------------------------------------------------------------------------------------------------------------------------
        // -
	    //---------------------------------------------------------------------------------------------------------------------------
		if( (appsItem)==(null) ) return;

        //---------------------------------------------------------------------------------------------------------------------------
        // -
	    //---------------------------------------------------------------------------------------------------------------------------
		GetList().Remove( appsItem as tagPurchase );

        //---------------------------------------------------------------------------------------------------------------------------
        // -
	    //---------------------------------------------------------------------------------------------------------------------------
    }

	//-------------------------------------------------------------------------------------------------------------------------------
	// 리스트를 얻기 위한 함수
	//-------------------------------------------------------------------------------------------------------------------------------
	public List<tagPurchase> GetList()
	{
        //---------------------------------------------------------------------------------------------------------------------------
        // -
	    //---------------------------------------------------------------------------------------------------------------------------
		return (Purchases);

        //---------------------------------------------------------------------------------------------------------------------------
        // -
	    //---------------------------------------------------------------------------------------------------------------------------
	}

    //-------------------------------------------------------------------------------------------------------------------------------
	// 모델 정보를 검색하기 위한 함수
	//-------------------------------------------------------------------------------------------------------------------------------
    public tagPurchase Find( string id )
    {
        //---------------------------------------------------------------------------------------------------------------------------
	    // -
	    //---------------------------------------------------------------------------------------------------------------------------
        if( (id)==(null) ) return (null);

        //---------------------------------------------------------------------------------------------------------------------------
	    // -
	    //---------------------------------------------------------------------------------------------------------------------------
        foreach( tagPurchase purchase in GetList() )
        {
            //-----------------------------------------------------------------------------------------------------------------------
	        // -
	        //-----------------------------------------------------------------------------------------------------------------------
            if( (purchase.id)==(id) )
            {
				return (purchase);
            }

            //-----------------------------------------------------------------------------------------------------------------------
	        // -
	        //-----------------------------------------------------------------------------------------------------------------------
        }

        //---------------------------------------------------------------------------------------------------------------------------
	    // -
	    //---------------------------------------------------------------------------------------------------------------------------
		return (null);
    }

	//-------------------------------------------------------------------------------------------------------------------------------
	// 구매 인터페이스를 요청하기 위한 함수
	//-------------------------------------------------------------------------------------------------------------------------------
	public objConfirm Purchase( tagPurchase purchase )
	{
		/*
		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		if( (purchase)==(null) ) return (null);

		//---------------------------------------------------------------------------------------------------------------------------
		// 구매할 수 없는 아이템입니다.
		//---------------------------------------------------------------------------------------------------------------------------
		if( !(purchase.sale) )
		{
			return app.Confirm.ON( app.Language.Get(TEXT.구매할_수_없는_아이템입니다) );
		}

		//---------------------------------------------------------------------------------------------------------------------------
		// 게임 중에만 구입할 수 있는 아이템입니다.
		//---------------------------------------------------------------------------------------------------------------------------
		if( (purchase.tag)==(TAG.BRONZE) && ( !app.Game.Is() || app.Player.Character()==(null) ) )
		{
			return app.Confirm.ON( app.Language.Get(TEXT.게임_중에만_구입할_수_있는_아이템입니다) );
		}

		//---------------------------------------------------------------------------------------------------------------------------
		// 큐브가 부족합니다.
		//---------------------------------------------------------------------------------------------------------------------------
		if( app.Account.Cash()<(purchase.cash) )
		{
			return app.Confirm.ON( app.Language.Get(TEXT.큐브가_부족합니다), (CONFIRM.YESNO), (app.ViewCharge.funcOnAndDownload) );
		}
		*/

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		return app.Confirm.ON( Func.Script( app.Language.Get(TEXT.__를_구매하시겠습니까), app.Language.Get(purchase.Name()) ), (CONFIRM.YESNO), (funcPurchase), (purchase) );
	}

	//-------------------------------------------------------------------------------------------------------------------------------
	// 아이템 구매를 처리하기 위한 함수
	//-------------------------------------------------------------------------------------------------------------------------------
	public void funcPurchase( object wParam=(null), object lParam=(null) )
	{
		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		if( (wParam)==(null) || (wParam as tagPurchase)==(null) ) return;

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		tagPurchase		purchase	= (wParam as tagPurchase);

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		app.ViewIndigator.ON( this );
		Apps.Buy( purchase.id );

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
	}

	//-------------------------------------------------------------------------------------------------------------------------------
	// 로컬에 저장된 정보를 불러오기 위한 함수
	//-------------------------------------------------------------------------------------------------------------------------------
	public override void OnLoadCache( tagAppsItem appsItem, AppsParameter col=(null) )
	{
        //---------------------------------------------------------------------------------------------------------------------------
        // -
	    //---------------------------------------------------------------------------------------------------------------------------
		if( (appsItem)==(null) ) return;
//		if( (col)==(null) ) return;	//(NULL)값을 허용함

        //---------------------------------------------------------------------------------------------------------------------------
        // -
	    //---------------------------------------------------------------------------------------------------------------------------
		tagPurchase		purchase	= (appsItem as tagPurchase);
		if( (purchase)==(null) ) return;

        //---------------------------------------------------------------------------------------------------------------------------
        // -
	    //---------------------------------------------------------------------------------------------------------------------------
		if( (col)!=(null) )
		{
			//-----------------------------------------------------------------------------------------------------------------------
			// -
			//-----------------------------------------------------------------------------------------------------------------------
			(purchase.instantly)	= col.GetBoolean("instantly");
			(purchase.account)		= col.GetBoolean("account");

			//-----------------------------------------------------------------------------------------------------------------------
			// -
			//-----------------------------------------------------------------------------------------------------------------------
			(purchase.url)			= col.Get("url");

			//-----------------------------------------------------------------------------------------------------------------------
			// -
			//-----------------------------------------------------------------------------------------------------------------------
		}

        //---------------------------------------------------------------------------------------------------------------------------
        // -
	    //---------------------------------------------------------------------------------------------------------------------------
		if( !GetList().Contains(purchase) )
		{
			GetList().Add(purchase);
		}

        //---------------------------------------------------------------------------------------------------------------------------
        // -
	    //---------------------------------------------------------------------------------------------------------------------------
	}

	//-------------------------------------------------------------------------------------------------------------------------------
	// XML 파일을 저장하기 위한 함수
	//-------------------------------------------------------------------------------------------------------------------------------
	public override void OnXmlSave( XmlTextWriter xmlWriter, tagAppsItem appsItem )
	{
        //---------------------------------------------------------------------------------------------------------------------------
        // -
	    //---------------------------------------------------------------------------------------------------------------------------
		if( (xmlWriter)==(null) ) return;
		if( (appsItem)==(null) ) return;

        //---------------------------------------------------------------------------------------------------------------------------
        // -
	    //---------------------------------------------------------------------------------------------------------------------------
		tagPurchase		purchase	= (appsItem as tagPurchase);
		if( (purchase)==(null) ) return;

        //---------------------------------------------------------------------------------------------------------------------------
        // -
	    //---------------------------------------------------------------------------------------------------------------------------
		CXml.WriteNodeValue( (xmlWriter), "instantly", (purchase.instantly) );
		CXml.WriteNodeValue( (xmlWriter), "account", (purchase.account) );

        //---------------------------------------------------------------------------------------------------------------------------
        // -
	    //---------------------------------------------------------------------------------------------------------------------------
		CXml.WriteNodeValue( (xmlWriter), "url", (purchase.url) );

        //---------------------------------------------------------------------------------------------------------------------------
        // -
	    //---------------------------------------------------------------------------------------------------------------------------
	}

	//-------------------------------------------------------------------------------------------------------------------------------
	// XML 파일을 불러오기 위한 함수
	//-------------------------------------------------------------------------------------------------------------------------------
	public override void OnXmlLoad( XmlNode pNode, tagAppsItem appsItem )
	{
        //---------------------------------------------------------------------------------------------------------------------------
        // -
	    //---------------------------------------------------------------------------------------------------------------------------
		if( (pNode)==(null) ) return;
		if( (appsItem)==(null) ) return;

        //---------------------------------------------------------------------------------------------------------------------------
        // -
	    //---------------------------------------------------------------------------------------------------------------------------
		tagPurchase		purchase	= (appsItem as tagPurchase);
		if( (purchase)==(null) ) return;

        //---------------------------------------------------------------------------------------------------------------------------
        // -
	    //---------------------------------------------------------------------------------------------------------------------------
		(purchase.instantly)	= CXml.GetChildBoolean( (pNode), "instantly" );
		(purchase.account)		= CXml.GetChildBoolean( (pNode), "account" );

        //---------------------------------------------------------------------------------------------------------------------------
        // -
	    //---------------------------------------------------------------------------------------------------------------------------
		(purchase.url)			= CXml.GetChildValue( (pNode), "url" );

        //---------------------------------------------------------------------------------------------------------------------------
        // -
	    //---------------------------------------------------------------------------------------------------------------------------
	}

	//-------------------------------------------------------------------------------------------------------------------------------
	// -
	//-------------------------------------------------------------------------------------------------------------------------------
}

//-----------------------------------------------------------------------------------------------------------------------------------
// -
//-----------------------------------------------------------------------------------------------------------------------------------