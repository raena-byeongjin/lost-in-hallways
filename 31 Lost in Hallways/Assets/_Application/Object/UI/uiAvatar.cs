using System.Collections;
using System.Collections.Generic;
using UnityEngine.UI;
using UnityEngine;

//-----------------------------------------------------------------------------------------------------------------------------------
// 아바타 정보를 처리하기 위한 클래스
//-----------------------------------------------------------------------------------------------------------------------------------
public class uiAvatar : MonoBehaviour
{
	//-------------------------------------------------------------------------------------------------------------------------------
	// -
	//-------------------------------------------------------------------------------------------------------------------------------
	[System.Serializable]
	public class tagData
	{
		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		public Transform			transform		= (null);
		public GameObject			gameObject		= (null);
		public RawImage				back			= (null);

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		public tagAvatarStatic		body			= (null);
		public tagAvatarStatic		face			= (null);
		public tagAvatarStatic		hair			= (null);
		public tagAvatarStatic		kit				= (null);
		public tagAvatarStatic		backcolor		= (null);

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		public bool					autoResize		= (true);

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
	};
	public tagData		data		= new tagData();

	//-------------------------------------------------------------------------------------------------------------------------------
	// -
	//-------------------------------------------------------------------------------------------------------------------------------
	void Awake()
	{
		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		(data.transform)	= (transform);
		(data.gameObject)	= (gameObject);
		(data.back)			= (Transform().parent.GetComponent(typeof(RawImage)) as RawImage);

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
	}

	//-------------------------------------------------------------------------------------------------------------------------------
	// -
	//-------------------------------------------------------------------------------------------------------------------------------
	public void Set( tagAvatar avatar )
	{
		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		if( (avatar)==(null) ) return;

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		(data.body)	= Create( (0), (avatar.body) );
		(data.face)	= Create( (1), (avatar.face) );
		(data.hair)	= Create( (2), (avatar.hair) );
		(data.kit)	= Create( (3), (avatar.kit) );

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		if( Back()!=(null) && Apps.Is(avatar.backcolor) )
		{
			(Back().texture)	= (null);
//			(Back().color)		= CXml.convertColor(avatar.backcolor.resource);
		}

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
	}

	//-------------------------------------------------------------------------------------------------------------------------------
	// -
	//-------------------------------------------------------------------------------------------------------------------------------
	public void Randomize()
	{
		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		(data.body)	= Create( (0), CApp.This.AvatarStatic.GetRandom(UPDATE_TYPE.Body) );
		(data.face)	= Create( (1), CApp.This.AvatarStatic.GetRandom(UPDATE_TYPE.Face) );
		(data.hair)	= Create( (2), CApp.This.AvatarStatic.GetRandom(UPDATE_TYPE.Hair) );
		(data.kit)	= Create( (3), CApp.This.AvatarStatic.GetRandom(UPDATE_TYPE.Kit) );

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
	}

	//-------------------------------------------------------------------------------------------------------------------------------
	// 트랜스폼 객체를 얻기 위한 함수
	//-------------------------------------------------------------------------------------------------------------------------------
	public Transform Transform()
	{
		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		return (data.transform);

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
	}

	//-------------------------------------------------------------------------------------------------------------------------------
	// 게임 오브젝트를 얻기 위한 함수
	//-------------------------------------------------------------------------------------------------------------------------------
	public GameObject _GameObject()
	{
		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		return (data.gameObject);

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
	}

	//-------------------------------------------------------------------------------------------------------------------------------
	// 객체를 생성하기 위한 함수
	//-------------------------------------------------------------------------------------------------------------------------------
	tagAvatarStatic Create( int index, tagAvatarStatic avatarstatic )
	{
		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		if( (avatarstatic)==(null) ) return (null);

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		GameObject gameObject = (null);

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		if( (index)<(Transform().childCount) )
		{
			//-----------------------------------------------------------------------------------------------------------------------
			// -
			//-----------------------------------------------------------------------------------------------------------------------
			Transform transform = Transform().GetChild(index);
			if( (transform)!=(null) )
			{
				(gameObject) = (transform.gameObject);
			}

			//-----------------------------------------------------------------------------------------------------------------------
			// -
			//-----------------------------------------------------------------------------------------------------------------------
		}
		else
		{
			//-----------------------------------------------------------------------------------------------------------------------
			// -
			//-----------------------------------------------------------------------------------------------------------------------
			(gameObject)	= new GameObject();
			RectTransform	transform	= (gameObject.AddComponent(typeof(RectTransform)) as RectTransform);

			//-----------------------------------------------------------------------------------------------------------------------
			// -
			//-----------------------------------------------------------------------------------------------------------------------
			float	fScale	= (1f);
			if( data.autoResize )
			{
				(fScale)	= Func.Divide( ((Transform().parent as RectTransform).sizeDelta.x), (256f) );
			}

			//-----------------------------------------------------------------------------------------------------------------------
			// -
			//-----------------------------------------------------------------------------------------------------------------------
			transform.SetParent( Transform() );
			(transform.localPosition)		= new Vector3();
			(transform.localEulerAngles)	= new Vector3();
			(transform.localScale)			= new Vector3( (fScale), (fScale), (1) );

			//-----------------------------------------------------------------------------------------------------------------------
			// -
			//-----------------------------------------------------------------------------------------------------------------------
		}

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		CApp.This.AvatarStatic.CorverTextureDownload( (avatarstatic), (funcTextureDownloadEnd), (gameObject), (avatarstatic) );
		if( CApp.This.Download.Is() )
		{
			CApp.This.Download.Indigator();
		}

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		return (avatarstatic);
	}

	//-------------------------------------------------------------------------------------------------------------------------------
	// 객체를 생성하기 위한 함수
	//-------------------------------------------------------------------------------------------------------------------------------
	void funcTextureDownloadEnd( object wParam=(null), object lParam=(null) )
	{
		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		if( (wParam)==(null) || wParam.GetType()!=typeof(GameObject) ) return;
		if( (lParam)==(null) || lParam.GetType()!=typeof(tagAvatarStatic) ) return;

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		GameObject			gameObject			= (wParam as GameObject);
		tagAvatarStatic		avatarstatic		= (lParam as tagAvatarStatic);

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		RawImage image = (gameObject.GetComponent(typeof(RawImage)) as RawImage);
		if( (image)==(null) )
		{
			(image) = (gameObject.AddComponent(typeof(RawImage)) as RawImage);
		}

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		if( (image)!=(null) )
		{
			(image.raycastTarget)	= (false);
			(image.texture)			= avatarstatic.CorverTexture.GetTexture();
			image.SetNativeSize();
		}

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
	}

	//-------------------------------------------------------------------------------------------------------------------------------
	// 배경 객체를 얻기 위한 함수
	//-------------------------------------------------------------------------------------------------------------------------------
	public RawImage Back()
	{
		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		return (data.back);

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
	}

	//-------------------------------------------------------------------------------------------------------------------------------
	// -
	//-------------------------------------------------------------------------------------------------------------------------------
}

//-----------------------------------------------------------------------------------------------------------------------------------
// -
//-----------------------------------------------------------------------------------------------------------------------------------