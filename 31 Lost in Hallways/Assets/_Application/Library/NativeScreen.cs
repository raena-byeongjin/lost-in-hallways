using System.Collections;
using System.Collections.Generic;
using System;
using UnityEngine;

//-----------------------------------------------------------------------------------------------------------------------------------
// -
//-----------------------------------------------------------------------------------------------------------------------------------
public class NativeScreen : MonoBehaviour
{
	//-------------------------------------------------------------------------------------------------------------------------------
	// -
	//-------------------------------------------------------------------------------------------------------------------------------
	public static int		ScreenOutputStep			= (0);
	public static int		InNavigationScreenHeight	= (0);
	public static int		StatusBarHeight				= (0);
	public static int		NavigationBarHeight			= (0);
	public static int		UnFullScreenHeight			= (0);		//Status Bar와 Navigation Bar가 모두 포함된 스크린 높이
	public static bool		isNavigationBar				= (false);
	public float			delay						= (0);
	public tagCallback		callback					= (null);

	//-------------------------------------------------------------------------------------------------------------------------------
	// -
	//-------------------------------------------------------------------------------------------------------------------------------
	void Awake()
	{
        //---------------------------------------------------------------------------------------------------------------------------
        // Navigation Bar만 활성화된 화면 높이를 기억함
        //---------------------------------------------------------------------------------------------------------------------------
		if( Func.IsAndroid10Upper() )
		{
			//-----------------------------------------------------------------------------------------------------------------------
			// -
			//-----------------------------------------------------------------------------------------------------------------------
			(UnFullScreenHeight)						= (Screen.height);

			//-----------------------------------------------------------------------------------------------------------------------
			// -
			//-----------------------------------------------------------------------------------------------------------------------
			(ApplicationChrome.navigationBarState)		= (ApplicationChrome.States.VisibleOverContent);

			//-----------------------------------------------------------------------------------------------------------------------
			// -
			//-----------------------------------------------------------------------------------------------------------------------
		}
		else
		{
			//-----------------------------------------------------------------------------------------------------------------------
			// -
			//-----------------------------------------------------------------------------------------------------------------------
			(InNavigationScreenHeight)		= (Screen.height);

			//-----------------------------------------------------------------------------------------------------------------------
			// -
			//-----------------------------------------------------------------------------------------------------------------------
			(ApplicationChrome.statusBarState)			= (ApplicationChrome.States.Visible);
			(ApplicationChrome.navigationBarState)		= (ApplicationChrome.States.Visible);
			(Screen.fullScreen)		= (false);

			//-----------------------------------------------------------------------------------------------------------------------
			// -
			//-----------------------------------------------------------------------------------------------------------------------
		}

        //---------------------------------------------------------------------------------------------------------------------------
        // -
        //---------------------------------------------------------------------------------------------------------------------------
		(delay)	= (2f);

        //---------------------------------------------------------------------------------------------------------------------------
        // -
        //---------------------------------------------------------------------------------------------------------------------------
	}

	//-------------------------------------------------------------------------------------------------------------------------------
	// -
	//-------------------------------------------------------------------------------------------------------------------------------
	void Update()
	{
        //---------------------------------------------------------------------------------------------------------------------------
        // -
        //---------------------------------------------------------------------------------------------------------------------------
		if( Func.IsAndroid10Upper() )
		{
			Android10Upper();
		}
		else
		{
			Android10Under();
		}

        //---------------------------------------------------------------------------------------------------------------------------
        // -
        //---------------------------------------------------------------------------------------------------------------------------
	}

	//-------------------------------------------------------------------------------------------------------------------------------
	// 안드로이드 10 이상 버전의 화면 높이를 계산하기 위한 함수
	//-------------------------------------------------------------------------------------------------------------------------------
	void Android10Upper()
	{
        //---------------------------------------------------------------------------------------------------------------------------
        // -
        //---------------------------------------------------------------------------------------------------------------------------
		if( (ScreenOutputStep)==(0) && (Screen.height)!=(UnFullScreenHeight) )
		{
			//-----------------------------------------------------------------------------------------------------------------------
			// UnFullsScreenHeight = Navigation Bar와 Status Bar가 모두 활성화된 화면 높이
			//-----------------------------------------------------------------------------------------------------------------------
			(NavigationBarHeight)	= (Screen.height) - (UnFullScreenHeight);
			
//			Debug.Log( "("+(ScreenOutputStep)+") "+(Screen.height) );
//			Debug.Log( "NavigationBarHeight => "+(NavigationBarHeight) );

			//-----------------------------------------------------------------------------------------------------------------------
			// -
			//-----------------------------------------------------------------------------------------------------------------------
			(ApplicationChrome.statusBarState)			= (ApplicationChrome.States.Visible);
			(ApplicationChrome.navigationBarState)		= (ApplicationChrome.States.VisibleOverContent);
			(Screen.fullScreen)		= (false);

			//-----------------------------------------------------------------------------------------------------------------------
			// -
			//-----------------------------------------------------------------------------------------------------------------------
			(ScreenOutputStep)		= (1);
			(delay)					= (1f);

			//-----------------------------------------------------------------------------------------------------------------------
			// -
			//-----------------------------------------------------------------------------------------------------------------------
		}
		else
		if( (ScreenOutputStep)==(1) && (CApp.This)!=(null) && (Screen.height)!=(NativeScreen.UnFullScreenHeight) )
		{
			//-----------------------------------------------------------------------------------------------------------------------
			// -
			//-----------------------------------------------------------------------------------------------------------------------
			(ScreenOutputStep)	= (-1);
			GameObject.Destroy( gameObject );

			//-----------------------------------------------------------------------------------------------------------------------
			// -
			//-----------------------------------------------------------------------------------------------------------------------
		}
		else
		if( (delay)<=(0) )
		{
			//-----------------------------------------------------------------------------------------------------------------------
			// -
			//-----------------------------------------------------------------------------------------------------------------------
			(ScreenOutputStep)	= (-1);
			GameObject.Destroy( gameObject );

			//-----------------------------------------------------------------------------------------------------------------------
			// -
			//-----------------------------------------------------------------------------------------------------------------------
		}
		else
		{
			(delay)	-= (Time.deltaTime);
		}

        //---------------------------------------------------------------------------------------------------------------------------
        // -
        //---------------------------------------------------------------------------------------------------------------------------
	}

	//-------------------------------------------------------------------------------------------------------------------------------
	// 안드로이드 10 아래 버전의 화면 높이를 계산하기 위한 함수
	//-------------------------------------------------------------------------------------------------------------------------------
	void Android10Under()
	{
        //---------------------------------------------------------------------------------------------------------------------------
        // -
        //---------------------------------------------------------------------------------------------------------------------------
		switch( ScreenOutputStep )
		{
			//-----------------------------------------------------------------------------------------------------------------------
			// Navigation Bar와 Status Bar가 모두 활성화된 화면 높이를 계산함
			//-----------------------------------------------------------------------------------------------------------------------
			case (0):
				if( (Screen.height)!=(InNavigationScreenHeight) )
				{
					//---------------------------------------------------------------------------------------------------------------
					// UnFullsScreenHeight = Navigation Bar와 Status Bar가 모두 활성화된 화면 높이
					//---------------------------------------------------------------------------------------------------------------
					(StatusBarHeight)		= (InNavigationScreenHeight) - (Screen.height);
					(UnFullScreenHeight)	= (Screen.height);

//					Debug.Log( "("+(ScreenOutputStep)+") "+(Screen.height) );
//					Debug.Log( "StatusBarHeight => "+(StatusBarHeight) );

					//---------------------------------------------------------------------------------------------------------------
					// Status Bar는 활성화한 상태에서 Navigation Bar만 비활성화 함
					//---------------------------------------------------------------------------------------------------------------
					(ApplicationChrome.navigationBarState)		= (ApplicationChrome.States.VisibleOverContent);
					(ScreenOutputStep)		= (2);

					//---------------------------------------------------------------------------------------------------------------
					// -
					//---------------------------------------------------------------------------------------------------------------
				}
				break;

			//-----------------------------------------------------------------------------------------------------------------------
			// Status Bar는 활성화한 상태에서 Navigation Bar만 비활성화한 화면 높이를 계산함
			//-----------------------------------------------------------------------------------------------------------------------
			case (2):
				if( (Screen.height)!=(UnFullScreenHeight) )
				{
					//---------------------------------------------------------------------------------------------------------------
					// -
					//---------------------------------------------------------------------------------------------------------------
					(NavigationBarHeight)	= (Screen.height) - (UnFullScreenHeight);

//					Debug.Log( "("+(ScreenOutputStep)+") "+(Screen.height) );
//					Debug.Log( "NavigationBarHeight => "+(NavigationBarHeight) );

					//---------------------------------------------------------------------------------------------------------------
					// Navigation Bar와 Status Bar를 모두 활성화 함
					//---------------------------------------------------------------------------------------------------------------
					(ApplicationChrome.statusBarState)			= (ApplicationChrome.States.Visible);
					(ApplicationChrome.navigationBarState)		= (ApplicationChrome.States.Visible);
					(Screen.fullScreen)		= (false);
					(ScreenOutputStep)		= (3);

					//---------------------------------------------------------------------------------------------------------------
					// -
					//---------------------------------------------------------------------------------------------------------------
				}
				break;

			//-----------------------------------------------------------------------------------------------------------------------
			// -
			//-----------------------------------------------------------------------------------------------------------------------
			case (3):
				if( (Screen.height)==(UnFullScreenHeight) )
				{
					//---------------------------------------------------------------------------------------------------------------
					// -
					//---------------------------------------------------------------------------------------------------------------
					(ScreenOutputStep)		= (-1);

					//---------------------------------------------------------------------------------------------------------------
					// -
					//---------------------------------------------------------------------------------------------------------------
					GameObject.Destroy( gameObject );

					//---------------------------------------------------------------------------------------------------------------
					// -
					//---------------------------------------------------------------------------------------------------------------
				}
				break;

			//-----------------------------------------------------------------------------------------------------------------------
			// -
			//-----------------------------------------------------------------------------------------------------------------------
		}

        //---------------------------------------------------------------------------------------------------------------------------
        // -
        //---------------------------------------------------------------------------------------------------------------------------
	}

	//-------------------------------------------------------------------------------------------------------------------------------
	// -
	//-------------------------------------------------------------------------------------------------------------------------------
	public static bool IsNavigationBar()
	{
        //---------------------------------------------------------------------------------------------------------------------------
        // -
        //---------------------------------------------------------------------------------------------------------------------------
		return (isNavigationBar);

        //---------------------------------------------------------------------------------------------------------------------------
        // -
        //---------------------------------------------------------------------------------------------------------------------------
	}

	//-------------------------------------------------------------------------------------------------------------------------------
	// 풀스크린을 설정하기 위한 함수
	//-------------------------------------------------------------------------------------------------------------------------------
	public static void Fullscreen( bool option=(true) )
	{
		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		if( option )
		{
			//-----------------------------------------------------------------------------------------------------------------------
			// -
			//-----------------------------------------------------------------------------------------------------------------------
			if( !Func.IsAndroid10Upper() )
			{
				(ApplicationChrome.statusBarState)		= (ApplicationChrome.States.Hidden);
			}

			//-----------------------------------------------------------------------------------------------------------------------
			// -
			//-----------------------------------------------------------------------------------------------------------------------
			(ApplicationChrome.navigationBarState)		= (ApplicationChrome.States.Hidden);
			(Screen.fullScreen)		= (true);

			//-----------------------------------------------------------------------------------------------------------------------
			// -
			//-----------------------------------------------------------------------------------------------------------------------
			CApp.This.ViewNavigationBar.Inactive();

			//-----------------------------------------------------------------------------------------------------------------------
			// -
			//-----------------------------------------------------------------------------------------------------------------------
		}
		else
		{
			//-----------------------------------------------------------------------------------------------------------------------
			// -
			//-----------------------------------------------------------------------------------------------------------------------
			(ApplicationChrome.statusBarState)			= (ApplicationChrome.States.Visible);
			(ApplicationChrome.navigationBarState)		= (ApplicationChrome.States.VisibleOverContent);
			(Screen.fullScreen)		= (false);

			//-----------------------------------------------------------------------------------------------------------------------
			// -
			//-----------------------------------------------------------------------------------------------------------------------
			CApp.This.ViewNavigationBar.Active();

			//-----------------------------------------------------------------------------------------------------------------------
			// -
			//-----------------------------------------------------------------------------------------------------------------------
		}

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
	}

	//-------------------------------------------------------------------------------------------------------------------------------
	// -
	//-------------------------------------------------------------------------------------------------------------------------------
	public void SetCallback( Action<object, object> func, object wParam=(null), object lParam=(null) )
	{
		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		if( (func)==(null) ) return;
//		if( (wParam)==(null) ) return;	//(NULL)값을 허용함
//		if( (lParam)==(null) ) return;	//(NULL)값을 허용함

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		(callback)	= new tagCallback( (func), (wParam), (lParam) );

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
	}

	//-------------------------------------------------------------------------------------------------------------------------------
	// -
	//-------------------------------------------------------------------------------------------------------------------------------
	void OnDestroy()
	{
		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		CApp.This.ViewNavigationBar.ON( NativeScreen.NavigationBarHeight );

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		if( (callback)!=(null) && callback.Is() )
		{
			callback.Call();
		}

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
	}

	//-------------------------------------------------------------------------------------------------------------------------------
	// -
	//-------------------------------------------------------------------------------------------------------------------------------
}

//-----------------------------------------------------------------------------------------------------------------------------------
// -
//-----------------------------------------------------------------------------------------------------------------------------------