using System.Collections;
using System.Collections.Generic;
using UnityEngine;
using UnityEngine.EventSystems;
using UnityEngine.UI;

//-----------------------------------------------------------------------------------------------------------------------------------
// -
//-----------------------------------------------------------------------------------------------------------------------------------
public class TouchEventSystem : MonoBehaviour
{
	//-------------------------------------------------------------------------------------------------------------------------------
	// -
	//-------------------------------------------------------------------------------------------------------------------------------
	public Vector3	prePosition		= new Vector3();

	//-------------------------------------------------------------------------------------------------------------------------------
	// -
	//-------------------------------------------------------------------------------------------------------------------------------
	protected CApp		app			= (null);
	protected CPlay		play		= (null);

	//-------------------------------------------------------------------------------------------------------------------------------
	// -
	//-------------------------------------------------------------------------------------------------------------------------------
	void Awake()
	{
        //---------------------------------------------------------------------------------------------------------------------------
        // -
        //---------------------------------------------------------------------------------------------------------------------------
		(app)		= (CApp.This);
		(play)		= (CPlay.This);

        //---------------------------------------------------------------------------------------------------------------------------
        // -
        //---------------------------------------------------------------------------------------------------------------------------
	}

	//-------------------------------------------------------------------------------------------------------------------------------
	// -
	//-------------------------------------------------------------------------------------------------------------------------------
	void Update()
	{
        //---------------------------------------------------------------------------------------------------------------------------
        // -
        //---------------------------------------------------------------------------------------------------------------------------
		if( (app)==(null) ) Awake();
		if( (app)==(null) ) return;

        //---------------------------------------------------------------------------------------------------------------------------
        // 롤오버
        //---------------------------------------------------------------------------------------------------------------------------
		/*
		if( (Input.mousePosition)!=(this.prePosition) )
		{
			GameObject	obj		= Pick( play.uiCanvas.GraphicRaycaster(), (Input.mousePosition) );
			if( (obj)!=(null) )
			{
				objControl	control		= (obj.GetComponent(typeof(objControl)) as objControl);
				if( (control)!=(null) )
				{
					app.ONCONTROL( (control), (CONTROL_ACTION.ROLLOVER) );
				}
			}
		}
		*/

        //---------------------------------------------------------------------------------------------------------------------------
        // -
        //---------------------------------------------------------------------------------------------------------------------------
		if( Input.GetMouseButtonDown(0) )
		{
			//-----------------------------------------------------------------------------------------------------------------------
		    // -
	        //-----------------------------------------------------------------------------------------------------------------------
			GameObject obj = app.Canvas.Pick( Input.mousePosition );
			if( (obj)!=(null) )
			{
				//---------------------------------------------------------------------------------------------------------------
				// -
				//---------------------------------------------------------------------------------------------------------------
				if( TouchInterface.Push().time!=Time.time )
				{
					TouchInterface.Push().Reset();
				}

				//---------------------------------------------------------------------------------------------------------------
				// -
				//---------------------------------------------------------------------------------------------------------------
				if( !app.ONCLICK( (obj), (CONTROL_ACTION.LBUTTONDOWN) ) )
				{
					Button button = (obj.GetComponentInParent(typeof(Button)) as Button);
					if( (button)!=(null) )
					{
						objControl control = (button.GetComponent(typeof(objControl)) as objControl);
						if( (control)!=(null) )
						{
							app.ONCONTROL( (control), (CONTROL_ACTION.LBUTTONDOWN) );
						}
					}
				}

				//---------------------------------------------------------------------------------------------------------------
				// -
				//---------------------------------------------------------------------------------------------------------------
			}

			//-----------------------------------------------------------------------------------------------------------------------
		    // -
	        //-----------------------------------------------------------------------------------------------------------------------
		}

        //---------------------------------------------------------------------------------------------------------------------------
        // -
        //---------------------------------------------------------------------------------------------------------------------------
		if( Input.GetMouseButtonUp(0) )
		{
			//-----------------------------------------------------------------------------------------------------------------------
		    // -
	        //-----------------------------------------------------------------------------------------------------------------------
			GameObject obj = app.Canvas.Pick( Input.mousePosition );
			if( (obj)!=(null) )
			{
				if( !app.ONCLICK( (obj), (CONTROL_ACTION.LBUTTONUP) ) )
				{
					Button button = (obj.GetComponentInParent(typeof(Button)) as Button);
					if( (button)!=(null) )
					{
						objControl control = (button.GetComponent(typeof(objControl)) as objControl);
						if( (control)!=(null) )
						{
							app.ONCONTROL( (control), (CONTROL_ACTION.LBUTTONUP) );
						}
					}
				}
			}

			//-----------------------------------------------------------------------------------------------------------------------
		    // -
	        //-----------------------------------------------------------------------------------------------------------------------
		}
		else
		if( (EventSystem.current.currentSelectedGameObject)!=(null) && !Input.GetMouseButton(0) )
		{
			if( EventSystem.current.currentSelectedGameObject.GetComponent(typeof(InputField))==(null) )
			{
				EventSystem.current.SetSelectedGameObject( null );
			}
		}

#if UNITY_EDITOR || UNITY_STANDALONE
        //---------------------------------------------------------------------------------------------------------------------------
        // -
        //---------------------------------------------------------------------------------------------------------------------------
		if( Input.GetMouseButtonDown(1) )
		{
			//-----------------------------------------------------------------------------------------------------------------------
		    // -
	        //-----------------------------------------------------------------------------------------------------------------------
			GameObject	obj		= app.Canvas.Pick( Input.mousePosition );
			if( (obj)!=(null) )
			{
				//---------------------------------------------------------------------------------------------------------------
				// -
				//---------------------------------------------------------------------------------------------------------------
				TouchInterface.Context().Reset();

				//---------------------------------------------------------------------------------------------------------------
				// -
				//---------------------------------------------------------------------------------------------------------------
				if( !app.ONCLICK( (obj), (CONTROL_ACTION.MBUTTONDOWN) ) )
				{
					objControl	control		= (obj.GetComponent(typeof(objControl)) as objControl);
					if( (control)!=(null) )
					{
						app.ONCONTROL( (control), (CONTROL_ACTION.RBUTTONDOWN) );
					}
				}

				//---------------------------------------------------------------------------------------------------------------
				// -
				//---------------------------------------------------------------------------------------------------------------
			}

			//-----------------------------------------------------------------------------------------------------------------------
		    // -
	        //-----------------------------------------------------------------------------------------------------------------------
		}

        //---------------------------------------------------------------------------------------------------------------------------
        // -
        //---------------------------------------------------------------------------------------------------------------------------
		if( Input.GetMouseButtonUp(1) )
		{
			//-----------------------------------------------------------------------------------------------------------------------
		    // -
	        //-----------------------------------------------------------------------------------------------------------------------
			GameObject	obj		= app.Canvas.Pick( Input.mousePosition );
			if( (obj)!=(null) )
			{
				objControl	control		= (obj.GetComponent(typeof(objControl)) as objControl);
				if( (control)!=(null) )
				{
					app.ONCONTROL( (control), (CONTROL_ACTION.RBUTTONUP) );
				}
			}

			//-----------------------------------------------------------------------------------------------------------------------
		    // -
	        //-----------------------------------------------------------------------------------------------------------------------
		}

        //---------------------------------------------------------------------------------------------------------------------------
        // -
        //---------------------------------------------------------------------------------------------------------------------------
		if( Input.GetMouseButtonDown(2) )
		{
			//-----------------------------------------------------------------------------------------------------------------------
		    // -
	        //-----------------------------------------------------------------------------------------------------------------------
			GameObject obj = app.Canvas.Pick( Input.mousePosition );
			if( (obj)!=(null) )
			{
				//-------------------------------------------------------------------------------------------------------------------
				// -
				//-------------------------------------------------------------------------------------------------------------------
				TouchInterface.Wheel().Reset();

				//-------------------------------------------------------------------------------------------------------------------
				// -
				//-------------------------------------------------------------------------------------------------------------------
				if( !app.ONCLICK( (obj), (CONTROL_ACTION.MBUTTONDOWN) ) )
				{
					objControl	control		= (obj.GetComponent(typeof(objControl)) as objControl);
					if( (control)!=(null) )
					{
						app.ONCONTROL( (control), (CONTROL_ACTION.MBUTTONDOWN) );
					}
				}

				//-------------------------------------------------------------------------------------------------------------------
				// -
				//-------------------------------------------------------------------------------------------------------------------
			}

			//-----------------------------------------------------------------------------------------------------------------------
		    // -
	        //-----------------------------------------------------------------------------------------------------------------------
		}

        //---------------------------------------------------------------------------------------------------------------------------
        // -
        //---------------------------------------------------------------------------------------------------------------------------
		if( Input.GetMouseButtonUp(2) )
		{
			//-----------------------------------------------------------------------------------------------------------------------
		    // -
	        //-----------------------------------------------------------------------------------------------------------------------
			GameObject	obj		= app.Canvas.Pick( Input.mousePosition );
			if( (obj)!=(null) )
			{
				objControl	control		= (obj.GetComponent(typeof(objControl)) as objControl);
				if( (control)!=(null) )
				{
					app.ONCONTROL( (control), (CONTROL_ACTION.MBUTTONUP) );
				}
			}

			//-----------------------------------------------------------------------------------------------------------------------
		    // -
	        //-----------------------------------------------------------------------------------------------------------------------
		}
#endif

        //---------------------------------------------------------------------------------------------------------------------------
        // -
        //---------------------------------------------------------------------------------------------------------------------------
	}

	//-------------------------------------------------------------------------------------------------------------------------------
	// -
	//-------------------------------------------------------------------------------------------------------------------------------
}

//-----------------------------------------------------------------------------------------------------------------------------------
// -
//-----------------------------------------------------------------------------------------------------------------------------------