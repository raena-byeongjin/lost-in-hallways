using UnityEngine;
using System;
using System.Collections.Generic;
using System.Collections;

//다운로드 정보를 처리하기 위한 구조체
//[System.Serializable]
public class tagDownload
{
	public string				Name				= null;

	public string				url					= null;
	public tagTexture			texture				= null;
	public tagAssetBundle		assetBundle			= null;
	public List<tagCallback>	Callbasks			= new List<tagCallback>();

	public DownloadProtocol		http				= null;
	public bool					endStreaming		= false;
	public bool					Complete			= false;
	public tagLoadingTask		task				= null;
	public bool					allowStreaming		= true;		//스트리밍 다운로드를 허용함

	public string GetUrl()
	{
		if( http!=null && Library.Is(http.url) )
		{
			return (http.url);
		}
		else
		if( texture!=null && Library.Is(texture.url) )
		{
			return texture.url;
		}
		else
		if( assetBundle!=null && Library.Is(assetBundle.url) )
		{
			return assetBundle.url;
		}

		return url;
	}

	//-------------------------------------------------------------------------------------------------------------------------------
	// -
	//-------------------------------------------------------------------------------------------------------------------------------
	public override string ToString()
	{
		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		return (Name)+" ("+GetUrl()+")";

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
	}

	//-------------------------------------------------------------------------------------------------------------------------------
	// -
	//-------------------------------------------------------------------------------------------------------------------------------
	public void SetCallback( Action<object, object> func, object wParam=(null), object lParam=(null) )
	{
		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		if( (func)==(null) ) return;

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		Callbasks.Add( new tagCallback( (func), (wParam), (lParam) ) );

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
	}

	//-------------------------------------------------------------------------------------------------------------------------------
	// -
	//-------------------------------------------------------------------------------------------------------------------------------
	public void Call()
	{
		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		foreach( tagCallback func in Callbasks )
		{
			func.Call();
		}

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
	}

	//-------------------------------------------------------------------------------------------------------------------------------
	// 다운로드가 완료되었는지 확인하기 위한 함수
	//-------------------------------------------------------------------------------------------------------------------------------
	public bool IsLoad()
	{
		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		if( (assetBundle)!=(null) )
		{
			if( assetBundle.IsLoad() )
			{
				return true;
			}
		}
		else
		if( (texture)!=(null) )
		{
			if( texture.IsLoad() )
			{
				return true;
			}
		}
		else
		{
			if( (http)!=(null) )
			{
				if( (http.bytes)!=(null) )
				{
					return true;
				}
			}
		}

		//---------------------------------------------------------------------------------------------------------------------------
		// -
		//---------------------------------------------------------------------------------------------------------------------------
		return false;
	}

	//-------------------------------------------------------------------------------------------------------------------------------
	// -
	//-------------------------------------------------------------------------------------------------------------------------------
}

//-----------------------------------------------------------------------------------------------------------------------------------
// -
//-----------------------------------------------------------------------------------------------------------------------------------